<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çº¯æ–‡æœ¬Â·ç¼“å­˜è®°äº‹æœ¬</title>
    <style>
        /* æç®€é£æ ¼ï¼Œçº¯ç²¹æ–‡æœ¬è®°äº‹æœ¬ */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            background: #fafaf8;
            font-family: 'Segoe UI', 'Roboto', 'Helvetica Neue', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }
        .notepad {
            width: 100%;
            max-width: 750px;
            background-color: #fffefc;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.05), 0 0 0 1px #f0ede9 inset;
            padding: 28px 28px 32px;
        }
        h1 {
            font-size: 1.6rem;
            font-weight: 400;
            color: #3a3a3a;
            margin-top: 0;
            margin-bottom: 6px;
            letter-spacing: -0.01em;
            border-bottom: 1px solid #eae7e2;
            padding-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        h1 span {
            background: #ecebe6;
            font-size: 0.8rem;
            font-weight: 400;
            padding: 4px 12px;
            border-radius: 30px;
            color: #4f4c46;
            letter-spacing: 0.3px;
        }
        .editor-area {
            margin: 22px 0 18px;
        }
        textarea {
            width: 100%;
            min-height: 340px;
            padding: 20px 22px;
            border: none;
            background: #fffcf7;
            border-radius: 16px;
            font-size: 1rem;
            line-height: 1.65;
            font-family: 'SF Mono', 'Cascadia Code', 'Consolas', 'Monaco', monospace;
            resize: vertical;
            color: #2b2b2b;
            caret-color: #4f7a7a;
            box-shadow: inset 0 1px 4px rgba(0,0,0,0.02), inset 0 0 0 1px #e3dfd9;
            outline: none;
            transition: box-shadow 0.1s;
        }
        textarea:focus {
            box-shadow: inset 0 1px 5px rgba(80, 80, 80, 0.03), inset 0 0 0 2px #cbd5d0;
            background: #fffdfa;
        }
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 18px 0 8px;
            color: #5c5c5a;
            font-size: 0.85rem;
            padding: 0 4px;
        }
        .cache-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            background: #f3f1ee;
            padding: 6px 16px;
            border-radius: 40px;
            color: #3d3d38;
        }
        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .btn {
            background: #fff;
            border: 1px solid #dbd7d0;
            padding: 8px 20px;
            border-radius: 40px;
            font-size: 0.9rem;
            font-weight: 450;
            color: #3a3a3a;
            cursor: pointer;
            transition: 0.12s ease;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            background: #ffffff;
        }
        .btn:hover {
            background: #f3f1ee;
            border-color: #b3aea7;
            color: #1f1f1f;
        }
        .btn:active {
            background: #e3dfd9;
            transform: scale(0.98);
        }
        .btn-save {
            background: #eae9e3;
            border-color: #b9b6ad;
            font-weight: 500;
        }
        .btn-save:hover {
            background: #dad8cf;
            border-color: #9e9a92;
        }
        .word-count {
            background: transparent;
            padding: 6px 12px;
            border-radius: 30px;
            border: 1px solid #e2dfd9;
            color: #5e5e59;
        }
        hr {
            border: none;
            border-top: 1px solid #e7e4df;
            margin: 22px 0 10px;
        }
        .footer-note {
            font-size: 0.75rem;
            color: #94908b;
            display: flex;
            justify-content: flex-end;
            align-items: center;
            gap: 16px;
        }
        .clear-btn {
            background: none;
            border: none;
            color: #8b8882;
            text-decoration: underline dotted;
            font-size: 0.75rem;
            cursor: pointer;
            padding: 4px 8px;
        }
        .clear-btn:hover {
            color: #4c4a46;
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="notepad">
        <h1>
            ğŸ““ çº¯æ–‡æœ¬è®°äº‹æœ¬
            <span>localStorage</span>
        </h1>
        
        <!-- æ ¸å¿ƒï¼šæ–‡æœ¬è¾“å…¥åŒº Â· æ²¡æœ‰ä»»ä½•æ ¼å¼åŒ–ï¼Œçº¯æ–‡æœ¬ -->
        <div class="editor-area">
            <textarea id="notepadTextarea" placeholder="âœï¸ åœ¨è¿™é‡Œå†™ç‚¹ä¸œè¥¿â€¦â€¦ (è‡ªåŠ¨ä¿å­˜åœ¨æµè§ˆå™¨ç¼“å­˜ä¸­)"></textarea>
        </div>
        
        <!-- çŠ¶æ€æ ï¼šç¼“å­˜çŠ¶æ€ + å­—æ•°ç»Ÿè®¡ -->
        <div class="status-bar">
            <div class="cache-indicator" id="cacheStatus">
                <span>ğŸ’¾</span> <span id="cacheMessage">ç¼“å­˜å·²å°±ç»ª</span>
            </div>
            <div class="word-count" id="wordCountDisplay">
                0 å­—ç¬¦
            </div>
        </div>
        
        <!-- æ“ä½œæŒ‰é’®ç»„ï¼šæ‰‹åŠ¨ä¿å­˜ / åŠ è½½ / æ¸…ç©ºç¼–è¾‘å™¨ (ç¼“å­˜ç‹¬ç«‹æ“ä½œ) -->
        <div class="btn-group">
            <button class="btn btn-save" id="saveBtn">ğŸ’¿ ä¿å­˜åˆ°ç¼“å­˜</button>
            <button class="btn" id="loadBtn">ğŸ“‚ ä»ç¼“å­˜åŠ è½½</button>
            <button class="btn" id="clearEditorBtn">ğŸ—‘ï¸ æ¸…ç©ºç¼–è¾‘å™¨</button>
        </div>
        
        <hr>
        
        <!-- åº•éƒ¨ï¼šç¼“å­˜ç‹¬ç«‹æ¸…ç†ï¼Œä¸ä¸¢å¤±ç¼–è¾‘å™¨å†…å®¹ï¼ˆä½†å¯å•ç‹¬æ¸…é™¤ç¼“å­˜ï¼‰ -->
        <div class="footer-note">
            <span>ğŸ“Œ ä¿®æ”¹åè‡ªåŠ¨ä¿å­˜ Â· å…³é—­é¡µé¢å†æ‰“å¼€ï¼Œå†…å®¹è¿˜åœ¨</span>
            <button class="clear-btn" id="clearCacheBtn">æ¸…é™¤ç¼“å­˜æ•°æ®</button>
        </div>
    </div>

    <script>
        (function() {
            "use strict";

            // --- ç¼“å­˜é”®å ---
            const STORAGE_KEY = "plain_text_notepad_v1";

            // --- DOM å…ƒç´  ---
            const textarea = document.getElementById("notepadTextarea");
            const saveBtn = document.getElementById("saveBtn");
            const loadBtn = document.getElementById("loadBtn");
            const clearEditorBtn = document.getElementById("clearEditorBtn");
            const clearCacheBtn = document.getElementById("clearCacheBtn");
            const cacheMessage = document.getElementById("cacheMessage");
            const wordCountDisplay = document.getElementById("wordCountDisplay");

            // --- è¾…åŠ©å‡½æ•°: æ›´æ–°å­—æ•°ç»Ÿè®¡ ---
            function updateWordCount() {
                const text = textarea.value;
                const charCount = text.length;
                wordCountDisplay.textContent = charCount + ' å­—ç¬¦';
            }

            // --- è¾…åŠ©å‡½æ•°: æ˜¾ç¤ºç¼“å­˜çŠ¶æ€æ¶ˆæ¯ï¼ˆçŸ­æš‚æç¤º + å›¾æ ‡å˜åŒ–ï¼‰---
            function showCacheMessage(msg, isPermanent = false) {
                cacheMessage.textContent = msg;
                if (!isPermanent) {
                    // çŸ­æš‚æç¤ºåæ¢å¤å¸¸è§„çŠ¶æ€ï¼ˆ3.5ç§’åæ¢å¤é»˜è®¤ï¼‰
                    clearTimeout(window._cacheMsgTimer);
                    window._cacheMsgTimer = setTimeout(() => {
                        // æ¢å¤ä¸ºâ€œç¼“å­˜å°±ç»ªâ€æˆ–è€…æ˜¾ç¤ºæœ€åä¿å­˜æ—¶é—´? ç®€å•èµ·è§æ¢å¤å°±ç»ª
                        cacheMessage.textContent = 'ç¼“å­˜å·²å°±ç»ª';
                    }, 3500);
                }
            }

            // --- ä¿å­˜åˆ° localStorage ---
            function saveToCache() {
                const content = textarea.value;
                try {
                    localStorage.setItem(STORAGE_KEY, content);
                    // æ›´æ–°çŠ¶æ€æ æç¤º
                    showCacheMessage('âœ“ å·²ä¿å­˜åˆ°ç¼“å­˜', false);
                    return true;
                } catch (e) {
                    console.error('ç¼“å­˜å†™å…¥å¤±è´¥:', e);
                    showCacheMessage('âš ï¸ ä¿å­˜å¤±è´¥ (å­˜å‚¨ç©ºé—´å¯èƒ½å·²æ»¡)', false);
                    return false;
                }
            }

            // --- ä» localStorage åŠ è½½ ---
            function loadFromCache() {
                try {
                    const savedContent = localStorage.getItem(STORAGE_KEY);
                    if (savedContent !== null) {
                        textarea.value = savedContent;
                        updateWordCount();
                        showCacheMessage('â†» å·²åŠ è½½ç¼“å­˜å†…å®¹', false);
                        return true;
                    } else {
                        // æ— ç¼“å­˜å†…å®¹: æ¸…ç©ºæˆ–ä¿æŒï¼Œå¹¶æç¤º
                        showCacheMessage('ğŸ“­ æš‚æ— ç¼“å­˜è®°å½•', false);
                        return false;
                    }
                } catch (e) {
                    console.error('ç¼“å­˜è¯»å–å¤±è´¥:', e);
                    showCacheMessage('âš ï¸ è¯»å–ç¼“å­˜å¤±è´¥', false);
                    return false;
                }
            }

            // --- æ¸…ç©ºç¼–è¾‘å™¨å†…å®¹ï¼ˆä»…æ–‡æœ¬åŒºï¼Œä¸å½±å“ç¼“å­˜ï¼‰---
            function clearEditor() {
                textarea.value = '';
                updateWordCount();
                showCacheMessage('âœ— ç¼–è¾‘å™¨å·²æ¸…ç©º', false);
                // ä¸æ”¹å˜ç¼“å­˜å†…å®¹
            }

            // --- å®Œå…¨æ¸…é™¤ç¼“å­˜ï¼ˆä»…åˆ é™¤å­˜å‚¨çš„æ•°æ®ï¼Œä¸å½±å“å½“å‰ç¼–è¾‘å™¨ï¼‰---
            function clearCache() {
                try {
                    localStorage.removeItem(STORAGE_KEY);
                    showCacheMessage('ğŸ§¹ ç¼“å­˜æ•°æ®å·²æ¸…é™¤', false);
                } catch (e) {
                    console.error('æ¸…é™¤ç¼“å­˜å¤±è´¥:', e);
                    showCacheMessage('âš ï¸ æ¸…é™¤ç¼“å­˜å¤±è´¥', false);
                }
            }

            // --- åˆå§‹åŒ–: é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨ä»ç¼“å­˜è¯»å–ï¼Œå¹¶æ˜¾ç¤ºåœ¨æ–‡æœ¬æ¡†---
            function initializeNotepad() {
                // å°è¯•åŠ è½½ç¼“å­˜å†…å®¹ï¼Œå¦‚æœå­˜åœ¨å°±å¡«å……ï¼›å¦åˆ™æ–‡æœ¬æ¡†ä¸ºç©ºï¼Œæç¤ºæ–°å»º
                const existed = loadFromCache();  // loadFromCache å†…éƒ¨æ›´æ–°å­—æ•°ã€æç¤º
                if (!existed) {
                    // åˆæ¬¡ä½¿ç”¨ï¼Œæ²¡æœ‰ä»»ä½•ç¼“å­˜ â€”â€” æ˜¾ç¤ºå‹å¥½çš„ç©ºç™½æç¤º
                    textarea.value = '';
                    updateWordCount();
                    cacheMessage.textContent = 'âœ¨ å†™ä½ çš„ç¬¬ä¸€æ®µç¬”è®°';
                } else {
                    // å·²åŠ è½½ç¼“å­˜ï¼Œæ›´æ–°å­—æ•°å·²ç»åœ¨ loadFromCache é‡Œè°ƒç”¨ updateWordCount()
                    // ä½† loadFromCache å†…éƒ¨è°ƒç”¨äº† updateWordCount æ²¡é—®é¢˜ã€‚
                }

                // è‡ªåŠ¨ä¿å­˜åŠŸèƒ½ï¼šç›‘å¬ input äº‹ä»¶ï¼Œæ¯æ¬¡ä¿®æ”¹éƒ½å†™å…¥ç¼“å­˜ï¼ˆé˜²æŠ–å¤„ç†ï¼Œæå‡æ€§èƒ½ï¼‰
                let autoSaveTimer = null;
                textarea.addEventListener('input', function() {
                    // å®æ—¶æ›´æ–°å­—æ•°ç»Ÿè®¡
                    updateWordCount();
                    
                    // è‡ªåŠ¨ä¿å­˜ï¼šé˜²æŠ–ï¼Œåœæ­¢è¾“å…¥500msåä¿å­˜åˆ°ç¼“å­˜
                    if (autoSaveTimer) {
                        clearTimeout(autoSaveTimer);
                    }
                    autoSaveTimer = setTimeout(() => {
                        const saveResult = saveToCache();   // è‡ªåŠ¨ä¿å­˜å¹¶æç¤º
                        if (saveResult) {
                            // è½»æç¤ºï¼Œä½†ä¸ºäº†é¿å…é¢‘ç¹åˆ·æ–°ï¼Œå¯ä»¥ä¸´æ—¶ä¿®æ”¹çŠ¶æ€æ¡
                            // saveToCache é‡Œå·²è°ƒç”¨ showCacheMessage('âœ“ å·²ä¿å­˜åˆ°ç¼“å­˜')
                            // é‚£å·²ç»ä¼šå±•ç¤ºæç¤ºï¼Œæˆ‘ä»¬ä¸éœ€è¦é¢å¤–åŠ¨ä½œã€‚
                        }
                    }, 600); // 600ms å»¶è¿Ÿä¿å­˜
                });

                // é¢å¤–é˜²æŠ–ï¼šåœ¨é¡µé¢å…³é—­ä¹‹å‰ä¹Ÿå¯ä»¥å°è¯•ä¿å­˜ï¼Œä½†inputé˜²æŠ–å·²è¶³å¤Ÿã€‚
                // è¾¹ç¼˜æƒ…å†µ: ä¸‡ä¸€å…³é—­æ—¶æœ€åä¸€æ¬¡å˜æ›´æœªä¿å­˜ï¼Ÿç”±äºä½¿ç”¨localStorageåŒæ­¥å†™å…¥ï¼Œé˜²æŠ–å¯èƒ½ä¼šä¸¢å¤±æœ€åå‡ ç™¾æ¯«ç§’å˜åŒ–ã€‚
                // å¢å¼º: åœ¨beforeunhook åšä¸€æ¬¡ç›´æ¥ä¿å­˜ã€‚
                window.addEventListener('beforeunload', function() {
                    // åŒæ­¥ä¿å­˜ï¼Œä¿è¯æœ€æœ«å†…å®¹ä¸ä¸¢
                    const current = textarea.value;
                    if (current !== localStorage.getItem(STORAGE_KEY)) {
                        localStorage.setItem(STORAGE_KEY, current);
                    }
                });
            }

            // --- ç»‘å®šæ‰‹åŠ¨æŒ‰é’®äº‹ä»¶ ---
            // ä¿å­˜æŒ‰é’®: ç«‹åˆ»å°†å½“å‰æ–‡æœ¬å­˜å…¥ç¼“å­˜
            saveBtn.addEventListener('click', function() {
                saveToCache();
            });

            // åŠ è½½æŒ‰é’®: ä»ç¼“å­˜è¯»å–å¹¶è¦†ç›–ç¼–è¾‘å™¨å†…å®¹
            loadBtn.addEventListener('click', function() {
                loadFromCache();
            });

            // æ¸…ç©ºç¼–è¾‘å™¨æŒ‰é’® (ä»…ä»…æ¸…ç©ºæ–‡æœ¬æ¡†ï¼Œç¼“å­˜ä¸å—å½±å“)
            clearEditorBtn.addEventListener('click', function() {
                clearEditor();
            });

            // æ¸…é™¤ç¼“å­˜æŒ‰é’® (åˆ é™¤localStorageä¸­çš„æ•°æ®ï¼Œç¼–è¾‘å™¨å†…å®¹ä¿ç•™ä¸å˜)
            clearCacheBtn.addEventListener('click', function() {
                clearCache();
            });

            // é¢å¤–: å¦‚æœç”¨æˆ·ç²˜è´´/æ‹–æ‹½æ–‡æœ¬, å­—æ•°ç»Ÿè®¡å·²ç»é€šè¿‡inputæ›´æ–°, è‡ªåŠ¨ä¿å­˜ä¹Ÿå·¥ä½œã€‚
            // ç¡®ä¿å­—æ•°ç»Ÿè®¡åœ¨ä»»ä½•å˜åŠ¨æ—¶éƒ½æ›´æ–° (åˆå§‹åŒ–)
            // åŒæ—¶ï¼Œåœ¨ç¼–è¾‘å™¨æ‰‹åŠ¨é€šè¿‡æŒ‰é’®åŠ è½½æ—¶ï¼ŒupdateWordCount å·²åœ¨ loadFromCache è°ƒç”¨ã€‚
            // ä½†ä»¥é˜²ä¸‡ä¸€ï¼ŒloadBtn æ‰§è¡Œ loadFromCache å·²ç»åŒ…å«æ›´æ–°å­—æ•°ã€‚

            // å¼€å§‹åˆå§‹åŒ–
            initializeNotepad();
        })();
    </script>

    <!-- 
        æç®€è®°äº‹æœ¬ Â· çº¯æ–‡æœ¬ Â· å®Œå…¨ä¾èµ–æµè§ˆå™¨ç¼“å­˜ (localStorage)
        ç‰¹ç‚¹: è‡ªåŠ¨ä¿å­˜ã€æ‰‹åŠ¨æ§åˆ¶ã€ç¼“å­˜ä¸ç¼–è¾‘å™¨æ“ä½œè§£è€¦
        æ²¡æœ‰ä»»ä½•åç«¯æˆ–ç¬¬ä¸‰æ–¹ä¾èµ–ï¼Œç¦»çº¿å¯ç”¨ã€‚
    -->
</body>
</html>